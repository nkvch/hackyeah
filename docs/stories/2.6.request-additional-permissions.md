# Story 2.6: Request Additional Permissions (Update Request)

**Epic:** 2 - Authorization & Access Requests  
**Story Number:** 2.6  
**Created:** 2025-10-04

---

## Status

**Ready**

---

## Story

**As an** external user with existing permissions,  
**I want to** request additional permissions or access to additional entities,  
**So that** I can expand my system access as my role evolves.

---

## Acceptance Criteria

1. User can create a new permission request while having active permissions
2. User can add new entities from Directory of Entities
3. User can request additional permission types
4. Upon submission, request status changes to "Updated"
5. Request goes through same approval workflow
6. Existing permissions remain active during approval process
7. Approver can see history of previous permissions
8. User receives confirmation of submission and upon approval

---

## Tasks / Subtasks

### Backend Tasks

- [ ] **Task 1: Create CreateAdditionalAccessRequestCommand** (AC: 1, 2, 3, 4)
  - [ ] Create `CreateAdditionalAccessRequestCommand.cs`
  - [ ] Properties: UserId, PermissionLines
  - [ ] Create handler
  - [ ] Logic:
    - Verify user has existing accepted permissions
    - Create new AccessRequest with Status = "Updated"
    - Add permission lines
    - Save
    - Send notification
  - [ ] Inject: IAccessRequestRepository

- [ ] **Task 2: Update AccessRequest entity** (AC: 4)
  - [ ] Support "Updated" status for additional permission requests
  - [ ] Link to previous request (optional)

- [ ] **Task 3: Create REST API endpoint** (AC: 1)
  - [ ] POST `/api/access-requests/additional`
  - [ ] `[Authorize]`
  - [ ] Create new request with Updated status

### Frontend Tasks

- [ ] **Task 4: Create "Request Additional Permissions" page** (AC: 2, 3)
  - [ ] Similar to Story 2.2 completion form
  - [ ] Pre-fill current entities (read-only, show what user already has)
  - [ ] Allow adding new entities
  - [ ] Allow requesting additional permissions for existing entities

- [ ] **Task 5: Add navigation link** (AC: 1)
  - [ ] In profile or dashboard: "Request Additional Access"
  - [ ] Only show if user has active permissions

### Testing Tasks

- [ ] **Task 6: Write tests**
  - [ ] Test: `CreateAdditional_ExistingPermissions_CreatesUpdatedRequest`
  - [ ] Test: `CreateAdditional_ExistingPermissionsRemainActive`

---

## Dev Notes

**Business Rule:** Users can request additional permissions while keeping existing ones active. New request goes through approval separately.

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-04 | 1.0 | Story created from Epic 2 | Product Owner |

