# Story 8.17: Q&A Analytics (UKNF)

**Epic:** 8 - Entity Management & Q&A  
**Story Number:** 8.17  
**Created:** 2025-10-04

---

## Status

**Pending** ⏳

---

## Story

**As a** UKNF Employee or System Administrator,  
**I want to** view analytics on Q&A usage,  
**So that** I can understand what topics are most important to users.

---

## Acceptance Criteria

1. Employee can access "Q&A Analytics" dashboard showing:
   - Total questions submitted (all time, by period)
   - Questions by category (breakdown)
   - Questions by status (Pending, Answered, Published, Rejected)
   - Most viewed Q&A
   - Highest-rated Q&A
   - Lowest-rated Q&A (need improvement)
   - Average time to answer questions
   - Trending topics (based on recent submissions)
2. Analytics can be filtered by date range
3. Analytics can be exported (PDF or CSV)
4. Dashboard highlights areas needing attention (e.g., many pending questions, low-rated answers)

---

## Tasks / Subtasks

### Backend Tasks

- [ ] **Task 1: Create GetQAAnalyticsQuery** (AC: 1, 2)
  - [ ] Create `GetQAAnalyticsQuery.cs` in `Application/UknfPlatform.Application.Communication/QA/Queries/`
  - [ ] Query parameters: StartDate, EndDate
  - [ ] Create `GetQAAnalyticsQueryHandler.cs`
  - [ ] Inject IQuestionRepository
  - [ ] Calculate analytics:
    - **Total questions submitted**: Count by date range
    - **Questions by category**: Group by category, count
    - **Questions by status**: Group by status, count
    - **Most viewed Q&A**: Top 10 by ViewCount
    - **Highest-rated Q&A**: Top 10 by AverageRating
    - **Lowest-rated Q&A**: Bottom 10 by AverageRating (published only)
    - **Average time to answer**: Average of (AnsweredDate - SubmittedDate) for answered questions
    - **Trending topics**: Recent questions grouped by category or tags
  - [ ] Return QAAnalyticsDto

- [ ] **Task 2: Create QAAnalyticsDto** (AC: 1)
  - [ ] Create `QAAnalyticsDto.cs`
  - [ ] Properties:
    - TotalQuestions (int)
    - QuestionsByCategory (dictionary: category → count)
    - QuestionsByStatus (dictionary: status → count)
    - MostViewedQA (list of QuestionSummaryDto)
    - HighestRatedQA (list of QuestionSummaryDto)
    - LowestRatedQA (list of QuestionSummaryDto)
    - AverageTimeToAnswer (TimeSpan)
    - TrendingTopics (list of TopicTrendDto)
    - DateRange (StartDate, EndDate)

- [ ] **Task 3: Create TopicTrendDto** (AC: 1)
  - [ ] Properties: Topic (string), Count (int), Trend (string: "rising", "stable", "declining")

- [ ] **Task 4: Create ExportQAAnalyticsQuery** (AC: 3)
  - [ ] Create `ExportQAAnalyticsQuery.cs`
  - [ ] Query parameters: StartDate, EndDate, Format (CSV or PDF)
  - [ ] Generate analytics report in specified format
  - [ ] Return file stream

- [ ] **Task 5: Create REST API endpoints** (AC: 1, 2, 3)
  - [ ] GET /api/admin/qa/analytics (get analytics)
  - [ ] GET /api/admin/qa/analytics/export (export analytics)
  - [ ] Add `[Authorize]` with UKNF role check
  - [ ] Query parameters: startDate, endDate, format
  - [ ] Return 200 with analytics data or file
  - [ ] Add Swagger documentation

### Frontend Tasks

- [ ] **Task 6: Create qa-analytics-dashboard component** (AC: 1, 2)
  - [ ] Create `src/Frontend/uknf-platform-ui/src/app/features/admin/qa-analytics/qa-analytics-dashboard.component.ts`
  - [ ] Configure routing: `/admin/qa/analytics` (UKNF only)
  - [ ] Dashboard layout with cards/sections

- [ ] **Task 7: Display summary metrics** (AC: 1)
  - [ ] Cards showing:
    - Total Questions (with period comparison)
    - Pending Questions (highlight if > threshold)
    - Answered Questions
    - Published Questions
    - Average Time to Answer (in hours or days)
  - [ ] Use prominent numbers with icons

- [ ] **Task 8: Display category breakdown** (AC: 1)
  - [ ] Pie chart or bar chart
  - [ ] Show questions by category
  - [ ] Interactive (click to filter)

- [ ] **Task 9: Display status breakdown** (AC: 1)
  - [ ] Donut chart or stacked bar chart
  - [ ] Show questions by status
  - [ ] Color-coded (Pending: yellow, Answered: blue, Published: green, Rejected: red)

- [ ] **Task 10: Display top Q&A lists** (AC: 1)
  - [ ] Three sections:
    - **Most Viewed Q&A**: Top 10 with view counts
    - **Highest Rated Q&A**: Top 10 with ratings
    - **Lowest Rated Q&A**: Bottom 10 (needs improvement)
  - [ ] Each item clickable to view Q&A details
  - [ ] Highlight low-rated Q&A in red

- [ ] **Task 11: Display trending topics** (AC: 1)
  - [ ] Tag cloud or list
  - [ ] Show recent popular topics/tags
  - [ ] Size or color indicates trend intensity

- [ ] **Task 12: Add date range filter** (AC: 2)
  - [ ] Date range picker at top of dashboard
  - [ ] Preset options: Last 7 days, Last 30 days, Last 90 days, All time, Custom
  - [ ] Reload analytics on date change

- [ ] **Task 13: Add export functionality** (AC: 3)
  - [ ] "Export" button
  - [ ] Format selector: CSV or PDF
  - [ ] Download exported file
  - [ ] Show loading indicator during export

- [ ] **Task 14: Highlight attention areas** (AC: 4)
  - [ ] Alert box or notification if:
    - Many pending questions (e.g., > 10)
    - Low-rated published Q&A (rating < 2.5)
    - Long average time to answer (e.g., > 7 days)
  - [ ] Action links: "Review Pending Questions", "Improve Low-Rated Q&A"

### Testing Tasks

- [ ] **Task 15: Write unit tests**
  - [ ] Test: GetQAAnalyticsQuery calculates metrics correctly
  - [ ] Test: Category breakdown groups questions correctly
  - [ ] Test: Average time to answer is calculated correctly
  - [ ] Test: Trending topics are identified

- [ ] **Task 16: Write integration tests**
  - [ ] Test: GET /api/admin/qa/analytics returns analytics
  - [ ] Test: Date range filtering works
  - [ ] Test: Export generates CSV/PDF
  - [ ] Test: Authorization checks

---

## Dev Notes

### Analytics Calculations

**Average Time to Answer:**
```csharp
var averageTime = questions
    .Where(q => q.AnsweredDate.HasValue)
    .Select(q => (q.AnsweredDate.Value - q.SubmittedDate).TotalHours)
    .Average();
```

**Trending Topics:**
- Count questions by category/tags in recent period (e.g., last 30 days)
- Compare with previous period to identify rising topics
- Classify as: Rising (increasing), Stable (same), Declining (decreasing)

### Dashboard Layout

**Top Section:**
- Summary cards in row: Total, Pending, Answered, Published, Avg Time to Answer

**Middle Section:**
- Two columns:
  - Left: Category breakdown (chart)
  - Right: Status breakdown (chart)

**Bottom Section:**
- Three columns:
  - Most Viewed Q&A
  - Highest Rated Q&A
  - Lowest Rated Q&A (needs improvement)

**Footer:**
- Trending topics tag cloud

### Attention Alerts

Display prominent alerts for:
- **High Pending Queue**: "> 10 pending questions need answers"
- **Low-Rated Content**: "> 5 published Q&A with rating < 2.5"
- **Slow Response Time**: "Average time to answer is 10 days (target: < 3 days)"

### Export Formats

**CSV Export:**
- Summary metrics
- Questions by category table
- Questions by status table
- Top viewed/rated Q&A lists

**PDF Export:**
- Formatted report with charts
- Summary page
- Detailed metrics
- Recommendations based on data

### Performance

- Cache analytics for performance (update every hour)
- Use database aggregation functions
- Implement efficient queries with indexes
- Consider pre-calculating common metrics

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-04 | 1.0 | Story created from Epic 8 | Scrum Master (AI) |

---

## Dev Agent Record

_This section will be populated by the development agent during implementation._

---

## QA Results

_This section will be populated by QA agent after story completion._

