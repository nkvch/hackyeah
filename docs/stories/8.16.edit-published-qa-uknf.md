# Story 8.16: Edit Published Q&A (UKNF)

**Epic:** 8 - Entity Management & Q&A  
**Story Number:** 8.16  
**Created:** 2025-10-04

---

## Status

**Pending** â³

---

## Story

**As a** UKNF Employee,  
**I want to** edit published Q&A pairs,  
**So that** I can keep information accurate and up-to-date.

---

## Acceptance Criteria

1. Employee can select published Q&A and click "Edit"
2. Employee can modify: Question title, Question content, Answer, Category, Tags
3. Changes take effect immediately (live update)
4. Users see updated content on next view
5. System maintains edit history showing all changes
6. Edit is logged with timestamp and employee ID
7. If significant changes are made, consider notifying users who previously rated the Q&A

---

## Tasks / Subtasks

### Backend Tasks

- [ ] **Task 1: Create UpdatePublishedQuestionCommand** (AC: 1, 2, 3, 6)
  - [ ] Create `UpdatePublishedQuestionCommand.cs` in `Application/UknfPlatform.Application.Communication/QA/Commands/`
  - [ ] Command properties: QuestionId, Title, Content, Answer, Category, Tags
  - [ ] Create `UpdatePublishedQuestionCommandHandler.cs`
  - [ ] Inject IQuestionRepository, IQuestionEditHistoryRepository, ICurrentUserService, IHtmlSanitizer, ILogger
  - [ ] Handler logic:
    - Get question by ID
    - Verify question is published
    - Create edit history entry (before changes)
    - Update question fields
    - Sanitize HTML in answer
    - Save to repository
    - Log edit
    - Optionally: Trigger notification if significant changes (AC: 7)
    - Return success

- [ ] **Task 2: Create QuestionEditHistory entity** (AC: 5)
  - [ ] Create `QuestionEditHistory.cs` in `Domain/UknfPlatform.Domain.Communication/Entities/`
  - [ ] Properties:
    - Id (Guid)
    - QuestionId (Guid)
    - EditedBy (Guid) - employee ID
    - EditedDate (DateTime)
    - FieldChanged (string) - e.g., "Answer", "Title"
    - PreviousValue (text)
    - NewValue (text)

- [ ] **Task 3: Create GetQuestionEditHistoryQuery** (AC: 5)
  - [ ] Create `GetQuestionEditHistoryQuery.cs`
  - [ ] Query parameters: QuestionId
  - [ ] Return list of QuestionEditHistoryDto
  - [ ] UKNF Employees only

- [ ] **Task 4: Create UpdatePublishedQuestionCommandValidator** (AC: 2)
  - [ ] Validate Title: NotEmpty, MaxLength(500)
  - [ ] Validate Content: NotEmpty
  - [ ] Validate Answer: NotEmpty
  - [ ] Validate Category: NotEmpty, valid category
  - [ ] Validate Tags: Each tag max 50 chars
  - [ ] Verify question is published

- [ ] **Task 5: Create REST API endpoints** (AC: 1, 2, 5)
  - [ ] PUT /api/admin/qa/questions/{id}/published (edit published Q&A)
  - [ ] GET /api/admin/qa/questions/{id}/edit-history (view edit history)
  - [ ] Add `[Authorize]` with UKNF role check
  - [ ] Return 200 OK with updated Q&A
  - [ ] Return 400 for validation errors
  - [ ] Return 404 if question not found
  - [ ] Add Swagger documentation

- [ ] **Task 6: Optional: Notification for significant changes** (AC: 7)
  - [ ] Define "significant change" criteria (e.g., answer changed by > 50%)
  - [ ] If significant, optionally notify users who rated the Q&A
  - [ ] Notification: "A Q&A you rated has been significantly updated. Would you like to review your rating?"
  - [ ] Can be deferred to future enhancement

### Frontend Tasks

- [ ] **Task 7: Add "Edit" button to published Q&A** (AC: 1)
  - [ ] Add button to question detail page (admin view)
  - [ ] Show only for published Q&A
  - [ ] Navigate to edit page or open edit modal

- [ ] **Task 8: Create edit-published-question component** (AC: 2)
  - [ ] Create `src/Frontend/uknf-platform-ui/src/app/features/admin/qa-management/edit-published-question/edit-published-question.component.ts`
  - [ ] Configure routing: `/admin/qa/questions/:id/edit` or modal
  - [ ] Reactive form with fields:
    - title (input, required)
    - content (textarea, required)
    - answer (WYSIWYG editor, required)
    - category (dropdown, required)
    - tags (chips input, optional)
  - [ ] Pre-populate form with current Q&A data

- [ ] **Task 9: Implement form submission** (AC: 3, 4, 6)
  - [ ] On submit, call API to update Q&A
  - [ ] Show loading spinner
  - [ ] On success:
    - Show success message: "Q&A updated successfully!"
    - Redirect to question detail or close modal
    - Q&A is immediately updated (live)
  - [ ] On error: Display error message

- [ ] **Task 10: Add edit history view** (AC: 5)
  - [ ] Add "Edit History" tab or section in question detail (admin view)
  - [ ] Display edit history table
  - [ ] Columns: Date, Edited By, Field, Previous Value, New Value
  - [ ] Chronological order (newest first)

- [ ] **Task 11: Show "Last Edited" indicator** (AC: 4, 6)
  - [ ] Display "Last edited: [date] by [employee name]" on Q&A detail
  - [ ] Show to UKNF Employees only
  - [ ] Optionally show to public users: "Last updated: [date]"

### Testing Tasks

- [ ] **Task 12: Write unit tests**
  - [ ] Test: UpdatePublishedQuestionCommandHandler updates Q&A
  - [ ] Test: Edit history entry is created
  - [ ] Test: Answer HTML is sanitized
  - [ ] Test: Changes are logged
  - [ ] Test: Cannot edit unpublished Q&A with this command

- [ ] **Task 13: Write integration tests**
  - [ ] Test: PUT /api/admin/qa/questions/:id/published updates Q&A
  - [ ] Test: Updated Q&A is immediately visible to users
  - [ ] Test: Edit history is recorded
  - [ ] Test: Authorization checks work

---

## Dev Notes

### Live Updates

- Changes take effect immediately (no staging)
- Users see updated content on next page load or refresh
- Consider adding "Last updated" timestamp in public view

### Edit History

Track all edits for:
- Audit purposes
- Understanding Q&A evolution
- Rollback capability (future enhancement)

Store field-level changes:
- Which field changed (Title, Content, Answer, etc.)
- Previous value
- New value
- Who made the change
- When the change was made

### Significant Changes

Criteria for "significant change" (AC: 7):
- Answer completely rewritten (> 50% different)
- Answer meaning fundamentally changed
- Category changed
- Question meaning changed

Notification can be:
- Email to users who rated
- In-app notification
- Or skip for MVP (can be added later)

### User Experience (UKNF)

- Make editing easy with inline edit or dedicated edit page
- Pre-fill all current values
- Provide WYSIWYG editor for answer
- Show clear confirmation after save
- Display edit history for transparency

### User Experience (Public)

- Show "Last updated" date on Q&A (optional)
- Consider showing version number (future)
- Don't show who edited (internal info)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-04 | 1.0 | Story created from Epic 8 | Scrum Master (AI) |

---

## Dev Agent Record

_This section will be populated by the development agent during implementation._

---

## QA Results

_This section will be populated by QA agent after story completion._

