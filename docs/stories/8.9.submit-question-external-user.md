# Story 8.9: Submit Question (External User)

**Epic:** 8 - Entity Management & Q&A  
**Story Number:** 8.9  
**Created:** 2025-10-04

---

## Status

**Pending** ‚è≥

---

## Story

**As an** External User,  
**I want to** anonymously submit a question,  
**So that** I can get answers to issues without creating a case.

---

## Acceptance Criteria

1. User can access "Q&A" or "Ask a Question" section
2. User provides:
   - **Title** (text, required, short question summary)
   - **Content** (text area, required, detailed question)
   - **Category** (dropdown, required) - e.g., "Reporting", "System Access", "Technical Issues", "General"
   - **Tags/Labels** (optional, multi-select or free text) - for better categorization
3. Question is submitted anonymously (user's identity is not visible in published Q&A)
4. System tracks submitter internally for follow-up but doesn't publish identity
5. Upon submission, question status is set to "Pending" (not yet published)
6. User receives confirmation message with question ID
7. UKNF Employee receives notification of new question
8. Question is added to UKNF Employee question queue
9. System logs question submission with timestamp (internal user ID for tracking)

---

## Tasks / Subtasks

### Backend Tasks

- [ ] **Task 1: Create Question domain entity** (AC: 2, 3, 4, 5)
  - [ ] Create `Question.cs` in `Domain/UknfPlatform.Domain.Communication/Entities/`
  - [ ] Properties:
    - Id (Guid)
    - Title (string, max 500)
    - Content (text)
    - Category (string)
    - Tags (string, comma-separated or JSON array)
    - Status (enum: Pending, Answered, Published, Rejected)
    - SubmittedBy (Guid) - internal tracking only
    - SubmittedDate (DateTime)
    - Answer (text, nullable)
    - AnsweredBy (Guid?, nullable)
    - AnsweredDate (DateTime?, nullable)
    - PublishedDate (DateTime?, nullable)
    - ViewCount (int, default 0)
    - RatingSum (int, default 0)
    - RatingCount (int, default 0)
  - [ ] Add Status enum
  - [ ] Add domain methods: AddAnswer(), Publish(), Reject()

- [ ] **Task 2: Create SubmitQuestionCommand** (AC: 2, 3)
  - [ ] Create `SubmitQuestionCommand.cs` in `Application/UknfPlatform.Application.Communication/QA/Commands/`
  - [ ] Command properties: Title, Content, Category, Tags
  - [ ] Create `SubmitQuestionCommandHandler.cs`
  - [ ] Inject IQuestionRepository, ICurrentUserService, INotificationService, ILogger
  - [ ] Handler logic:
    - Create Question entity with status Pending
    - Set SubmittedBy = current user ID (internal)
    - Set SubmittedDate = now
    - Save to repository
    - Send notification to UKNF Employees
    - Log submission
    - Return question ID and confirmation

- [ ] **Task 3: Create SubmitQuestionCommandValidator** (AC: 2)
  - [ ] Validate Title: NotEmpty, MaxLength(500)
  - [ ] Validate Content: NotEmpty, MinLength(10)
  - [ ] Validate Category: NotEmpty, must be valid category
  - [ ] Validate Tags: Optional, each tag max 50 chars

- [ ] **Task 4: Create SubmitQuestionResponse** (AC: 6)
  - [ ] Create `SubmitQuestionResponse.cs`
  - [ ] Properties: QuestionId (Guid), Message (string), SubmittedDate (DateTime)

- [ ] **Task 5: Create REST API endpoint** (AC: 1, 2)
  - [ ] POST /api/qa/questions
  - [ ] Add `[Authorize]` attribute (authenticated users only)
  - [ ] Return 201 Created with question ID
  - [ ] Return 400 for validation errors
  - [ ] Add Swagger documentation

- [ ] **Task 6: Create notification for UKNF Employees** (AC: 7, 8)
  - [ ] Create QuestionSubmittedEvent
  - [ ] Event handler sends notification to UKNF Employees with Q&A management role
  - [ ] Notification includes question title and category

### Frontend Tasks

- [ ] **Task 7: Create submit-question component** (AC: 1, 2)
  - [ ] Create `src/Frontend/uknf-platform-ui/src/app/features/qa/submit-question/submit-question.component.ts`
  - [ ] Configure routing: `/qa/ask`
  - [ ] Reactive form with fields:
    - title (input, required, max 500)
    - content (textarea, required, min 10 chars)
    - category (dropdown, required)
    - tags (multi-select or chips input, optional)

- [ ] **Task 8: Implement category dropdown** (AC: 2)
  - [ ] Predefined categories: "Reporting", "System Access", "Technical Issues", "General"
  - [ ] Load from configuration or API

- [ ] **Task 9: Implement tags input** (AC: 2)
  - [ ] Use PrimeNG Chips or AutoComplete with multiple selection
  - [ ] Allow free text tag entry
  - [ ] Max 5 tags per question

- [ ] **Task 10: Handle form submission** (AC: 5, 6, 9)
  - [ ] On submit, call QA service
  - [ ] Show loading spinner
  - [ ] On success:
    - Display confirmation message with question ID
    - Message: "Your question has been submitted successfully. Question ID: {id}. You will be notified when it's answered."
    - Reset form
  - [ ] On error: Display error message
  - [ ] Use toast notifications

- [ ] **Task 11: Create form layout** (AC: 1)
  - [ ] Page title: "Ask a Question"
  - [ ] Info box: Explain Q&A system, anonymity, response time
  - [ ] Form sections with clear labels
  - [ ] Character counters for title and content
  - [ ] "Submit Question" and "Cancel" buttons
  - [ ] Tailwind CSS styling

### Testing Tasks

- [ ] **Task 12: Write unit tests**
  - [ ] Test: SubmitQuestionCommandHandler creates question with Pending status
  - [ ] Test: Submitter ID is stored but marked as internal
  - [ ] Test: Notification is sent to UKNF Employees
  - [ ] Test: Validator rejects invalid input

- [ ] **Task 13: Write integration tests**
  - [ ] Test: POST /api/qa/questions creates question
  - [ ] Test: Question is not visible in public Q&A until published
  - [ ] Test: Notification is sent

---

## Dev Notes

### Anonymity

- User's identity (SubmittedBy) is stored internally for audit and potential follow-up
- User's identity is NEVER displayed in published Q&A
- Only UKNF Employees can see who submitted a question (in admin view)

### Categories

Predefined categories help organize questions:
- **Reporting**: Questions about report submission, validation, etc.
- **System Access**: Login, permissions, account issues
- **Technical Issues**: System errors, bugs, performance
- **General**: Other questions

### Tags

- Optional but helpful for search and filtering
- Users can enter custom tags
- System can suggest popular tags

### Notification

UKNF Employees with Q&A management role receive notification:
- Email or in-app notification
- Includes question title, category, and submission date
- Link to question management interface

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-04 | 1.0 | Story created from Epic 8 | Scrum Master (AI) |

---

## Dev Agent Record

_This section will be populated by the development agent during implementation._

---

## QA Results

_This section will be populated by QA agent after story completion._

