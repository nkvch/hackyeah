# Story 8.3: View Entity Details (External User)

**Epic:** 8 - Entity Management & Q&A  
**Story Number:** 8.3  
**Created:** 2025-10-04

---

## Status

**Pending** ‚è≥

---

## Story

**As an** External User (Entity Administrator or Employee),  
**I want to** view my entity's information,  
**So that** I can verify data accuracy.

---

## Acceptance Criteria

1. External user can access "My Entity" or "Entity Information"
2. User sees entity details for entities they are assigned to
3. If user represents multiple entities, they select which entity to view
4. User views read-only entity data (cannot edit directly)
5. All entity fields are displayed (per Story 8.2 schema)
6. User can view entity change history
7. User can see when data was last updated
8. User can report discrepancy if data is incorrect (Story 8.5)

---

## Tasks / Subtasks

### Backend Tasks

- [ ] **Task 1: Create GetMyEntitiesQuery** (AC: 1, 2, 3)
  - [ ] Create `GetMyEntitiesQuery.cs` in `Application/UknfPlatform.Application.Communication/Entities/Queries/`
  - [ ] Get entities assigned to current external user
  - [ ] Return list of EntitySummaryDto
  - [ ] Filter based on user's entity assignments (from Epic 2)

- [ ] **Task 2: Create GetMyEntityDetailsQuery** (AC: 2, 4, 5, 6, 7)
  - [ ] Create `GetMyEntityDetailsQuery.cs`
  - [ ] Query parameters: EntityId
  - [ ] Verify user has access to this entity
  - [ ] Return EntityDetailDto (read-only)
  - [ ] Include change history
  - [ ] Include last updated date

- [ ] **Task 3: Create REST API endpoints** (AC: 1, 2)
  - [ ] GET /api/my-entity (returns list if multiple entities)
  - [ ] GET /api/my-entity/{id} (returns entity details)
  - [ ] Add `[Authorize]` attribute with external user check
  - [ ] Return 403 if user doesn't have access to entity
  - [ ] Return 404 if entity doesn't exist
  - [ ] Add Swagger documentation

### Frontend Tasks

- [ ] **Task 4: Create my-entity service** (AC: 1)
  - [ ] Create or update entities service
  - [ ] Method: `getMyEntities(): Observable<EntitySummary[]>`
  - [ ] Method: `getMyEntityDetails(id): Observable<EntityDetail>`

- [ ] **Task 5: Create my-entity component** (AC: 1, 2, 3, 4, 5)
  - [ ] Create `src/Frontend/uknf-platform-ui/src/app/features/entities/my-entity/my-entity.component.ts`
  - [ ] Configure routing: `/my-entity`
  - [ ] If single entity, show details directly
  - [ ] If multiple entities, show entity selector dropdown
  - [ ] Display all entity fields in read-only format
  - [ ] Use card layout for organized display

- [ ] **Task 6: Create entity selector** (AC: 3)
  - [ ] Dropdown with entity names
  - [ ] Show entity type and UKNF code
  - [ ] On selection, load entity details

- [ ] **Task 7: Display entity details** (AC: 4, 5, 7)
  - [ ] All fields from Story 8.2 schema
  - [ ] Grouped sections: Basic Info, Address, Contact, Registration
  - [ ] Read-only display
  - [ ] Show "Last Updated" timestamp
  - [ ] Style with Tailwind CSS

- [ ] **Task 8: Add change history tab** (AC: 6)
  - [ ] Display change history
  - [ ] Show: Date, Field, Previous Value, New Value, Changed By
  - [ ] Chronological order (newest first)

- [ ] **Task 9: Add "Report Data Change" button** (AC: 8)
  - [ ] Prominent button
  - [ ] Navigate to report change flow (Story 8.5)

### Testing Tasks

- [ ] **Task 10: Write unit tests**
  - [ ] Test: GetMyEntitiesQuery returns user's entities only
  - [ ] Test: GetMyEntityDetailsQuery checks user access
  - [ ] Test: Unauthorized access is blocked

- [ ] **Task 11: Write integration tests**
  - [ ] Test: External user can view their entities
  - [ ] Test: User cannot view other entities
  - [ ] Test: Multiple entity selection works
  - [ ] Test: Change history is visible

---

## Dev Notes

### Security

- External users can only view entities they are assigned to
- Verify user-entity relationship from Epic 2 (Access Requests)
- All data is read-only for external users
- External users cannot edit entity data directly (must report changes via Story 8.5)

### User Experience

- For users with single entity, skip selector and show details immediately
- For users with multiple entities, provide clear entity selector
- Make "Report Data Change" button prominent and easy to find

### Performance

- Cache entity assignments
- Load entity details on demand

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-04 | 1.0 | Story created from Epic 8 | Scrum Master (AI) |

---

## Dev Agent Record

_This section will be populated by the development agent during implementation._

---

## QA Results

_This section will be populated by QA agent after story completion._

