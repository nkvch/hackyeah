# Story 8.12: Publish Q&A

**Epic:** 8 - Entity Management & Q&A  
**Story Number:** 8.12  
**Created:** 2025-10-04

---

## Status

**Pending** ⏳

---

## Story

**As a** UKNF Employee,  
**I want to** publish answered questions,  
**So that** all users can benefit from the knowledge.

---

## Acceptance Criteria

1. Employee selects answered question and clicks "Publish"
2. Question status changes to "Published"
3. Q&A pair becomes visible to all users (internal and external) in FAQ section
4. Published Q&A displays: Question title, Question content, Category, Tags, Answer, Publication date
5. Submitter's identity remains anonymous
6. Published Q&A can be edited by UKNF Employees (edits are live)
7. Published Q&A can be unpublished (hidden from users) if needed
8. Publication is logged with timestamp and employee ID

---

## Tasks / Subtasks

### Backend Tasks

- [ ] **Task 1: Create PublishQuestionCommand** (AC: 1, 2, 3, 8)
  - [ ] Create `PublishQuestionCommand.cs` in `Application/UknfPlatform.Application.Communication/QA/Commands/`
  - [ ] Command properties: QuestionId (Guid)
  - [ ] Create `PublishQuestionCommandHandler.cs`
  - [ ] Inject IQuestionRepository, ICurrentUserService, ILogger
  - [ ] Handler logic:
    - Get question by ID
    - Verify question has answer (status is Answered)
    - Call question.Publish()
    - Set PublishedDate = DateTime.UtcNow
    - Update status to Published
    - Save to repository
    - Log publication
    - Publish QuestionPublishedEvent (optional, for notifications)
    - Return success

- [ ] **Task 2: Create UnpublishQuestionCommand** (AC: 7)
  - [ ] Create `UnpublishQuestionCommand.cs`
  - [ ] Handler changes status from Published back to Answered
  - [ ] Clear PublishedDate
  - [ ] Log unpublish action

- [ ] **Task 3: Add Publish domain method to Question entity** (AC: 2)
  - [ ] Method: `Publish()`
  - [ ] Validate question has answer
  - [ ] Update status to Published
  - [ ] Set PublishedDate

- [ ] **Task 4: Create REST API endpoints** (AC: 1, 7)
  - [ ] POST /api/admin/qa/questions/{id}/publish
  - [ ] POST /api/admin/qa/questions/{id}/unpublish
  - [ ] Add `[Authorize]` with UKNF role check
  - [ ] Return 200 OK with updated question
  - [ ] Return 400 if question doesn't have answer
  - [ ] Return 404 if question not found
  - [ ] Add Swagger documentation

### Frontend Tasks

- [ ] **Task 5: Add "Publish" button** (AC: 1)
  - [ ] Add button to question detail page (Story 8.10)
  - [ ] Show only if question status is Answered (has answer, not yet published)
  - [ ] Prominent styling to encourage publication

- [ ] **Task 6: Implement publish action** (AC: 2, 3)
  - [ ] On click, show confirmation dialog
  - [ ] Dialog: "Are you sure you want to publish this Q&A? It will be visible to all users."
  - [ ] On confirm, call publish API
  - [ ] On success:
    - Show success message: "Q&A published successfully!"
    - Update question status badge to "Published"
    - Reload question details
  - [ ] On error: Display error message

- [ ] **Task 7: Add "Unpublish" button** (AC: 7)
  - [ ] Add button to published question detail page
  - [ ] Show only if status is Published
  - [ ] On click, show confirmation dialog
  - [ ] Dialog: "Are you sure you want to unpublish this Q&A? It will be hidden from users."
  - [ ] On confirm, call unpublish API
  - [ ] Update status to Answered

- [ ] **Task 8: Display publication status** (AC: 2, 4)
  - [ ] Status badge: "Published" (green) or "Answered" (yellow) or "Pending" (gray)
  - [ ] Show publication date if published
  - [ ] Show "Published by [employee name]" (optional)

### Testing Tasks

- [ ] **Task 9: Write unit tests**
  - [ ] Test: PublishQuestionCommandHandler publishes question with answer
  - [ ] Test: Cannot publish question without answer
  - [ ] Test: PublishedDate is set
  - [ ] Test: UnpublishQuestionCommand unpublishes question

- [ ] **Task 10: Write integration tests**
  - [ ] Test: POST /api/admin/qa/questions/:id/publish publishes question
  - [ ] Test: Published Q&A is visible in public FAQ (Story 8.13)
  - [ ] Test: POST /api/admin/qa/questions/:id/unpublish hides Q&A
  - [ ] Test: Cannot publish question without answer (400)

---

## Dev Notes

### Publishing Workflow

```
Pending → Answered → Published
                ↓         ↑
                └─ Unpublish
```

### Visibility Rules

- **Pending**: Only UKNF Employees can see
- **Answered**: Only UKNF Employees can see
- **Published**: All users can see (internal and external)
- **Rejected**: Only UKNF Employees can see

### Anonymity

When Q&A is published:
- Question title, content, category, tags, answer are visible
- Submitter's identity is NEVER shown
- Only UKNF Employees can see who submitted (in admin view)

### Unpublish Use Cases

- Q&A contains outdated information
- Q&A needs significant revision
- Q&A was published by mistake
- Policy changed, making Q&A no longer valid

### Live Edits

Published Q&A can be edited (Story 8.16):
- Edits take effect immediately
- No "draft" mode for edits
- Consider notifying users who rated the Q&A (future enhancement)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-04 | 1.0 | Story created from Epic 8 | Scrum Master (AI) |

---

## Dev Agent Record

_This section will be populated by the development agent during implementation._

---

## QA Results

_This section will be populated by QA agent after story completion._

