<div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-md w-full space-y-8">
    <!-- Logo and Header -->
    <div class="text-center">
      <h1 class="text-4xl font-bold text-gray-900 mb-2">UKNF</h1>
      <h2 class="text-2xl font-semibold text-gray-700">Set Your Password</h2>
      <p class="mt-2 text-sm text-gray-600">Choose a strong password to secure your account</p>
    </div>

    <!-- Success State -->
    <div *ngIf="isSuccess" class="bg-white rounded-lg shadow-lg p-8 text-center">
      <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4">
        <i class="pi pi-check text-3xl text-green-600"></i>
      </div>
      <h3 class="text-xl font-semibold text-gray-900 mb-2">Password Set Successfully!</h3>
      <p class="text-gray-600 mb-4">Your account is ready. You will be redirected to the login page in {{ countdown }} seconds...</p>
      <p-button 
        label="Go to Login Now" 
        [routerLink]="['/auth/login']" 
        styleClass="p-button-success">
      </p-button>
    </div>

    <!-- Form State -->
    <div *ngIf="!isSuccess" class="bg-white rounded-lg shadow-lg p-8">
      <!-- Error Message -->
      <p-message 
        *ngIf="errorMessage" 
        severity="error" 
        [text]="errorMessage"
        styleClass="mb-4 w-full">
      </p-message>

      <!-- Form -->
      <form [formGroup]="setPasswordForm" (ngSubmit)="onSubmit()" class="space-y-6">
        
        <!-- Password Policy Requirements -->
        <div *ngIf="passwordPolicy" class="bg-blue-50 rounded-lg p-4 mb-4">
          <p class="text-sm font-medium text-gray-700 mb-2">Password Requirements:</p>
          <ul class="space-y-1 text-sm">
            <li class="flex items-center" [class.text-green-600]="policyRequirementsMet['minLength']" [class.text-gray-600]="!policyRequirementsMet['minLength']">
              <i class="pi mr-2" [class.pi-check-circle]="policyRequirementsMet['minLength']" [class.pi-circle]="!policyRequirementsMet['minLength']"></i>
              At least {{ passwordPolicy.minLength }} characters
            </li>
            <li *ngIf="passwordPolicy.requireUppercase" class="flex items-center" [class.text-green-600]="policyRequirementsMet['hasUppercase']" [class.text-gray-600]="!policyRequirementsMet['hasUppercase']">
              <i class="pi mr-2" [class.pi-check-circle]="policyRequirementsMet['hasUppercase']" [class.pi-circle]="!policyRequirementsMet['hasUppercase']"></i>
              Contains uppercase letter (A-Z)
            </li>
            <li *ngIf="passwordPolicy.requireLowercase" class="flex items-center" [class.text-green-600]="policyRequirementsMet['hasLowercase']" [class.text-gray-600]="!policyRequirementsMet['hasLowercase']">
              <i class="pi mr-2" [class.pi-check-circle]="policyRequirementsMet['hasLowercase']" [class.pi-circle]="!policyRequirementsMet['hasLowercase']"></i>
              Contains lowercase letter (a-z)
            </li>
            <li *ngIf="passwordPolicy.requireDigit" class="flex items-center" [class.text-green-600]="policyRequirementsMet['hasDigit']" [class.text-gray-600]="!policyRequirementsMet['hasDigit']">
              <i class="pi mr-2" [class.pi-check-circle]="policyRequirementsMet['hasDigit']" [class.pi-circle]="!policyRequirementsMet['hasDigit']"></i>
              Contains digit (0-9)
            </li>
            <li *ngIf="passwordPolicy.requireSpecialChar" class="flex items-center" [class.text-green-600]="policyRequirementsMet['hasSpecialChar']" [class.text-gray-600]="!policyRequirementsMet['hasSpecialChar']">
              <i class="pi mr-2" [class.pi-check-circle]="policyRequirementsMet['hasSpecialChar']" [class.pi-circle]="!policyRequirementsMet['hasSpecialChar']"></i>
              Contains special character (!@#$%^&*)
            </li>
          </ul>
        </div>

        <!-- Password Field -->
        <div class="field">
          <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
          <div class="relative">
            <input 
              id="password"
              pInputText
              [type]="showPassword ? 'text' : 'password'"
              formControlName="password"
              placeholder="Enter your password"
              autocomplete="new-password"
              class="w-full pr-10"
              [class.ng-invalid]="password?.invalid && password?.touched"
              [class.ng-dirty]="password?.touched" />
            <button 
              type="button"
              (click)="togglePasswordVisibility()"
              class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
              <i class="pi" [class.pi-eye]="!showPassword" [class.pi-eye-slash]="showPassword"></i>
            </button>
          </div>
          <small *ngIf="password?.invalid && password?.touched" class="text-red-600">
            Password is required and must be at least 8 characters
          </small>
          
          <!-- Password Strength Indicator -->
          <app-password-strength 
            [password]="passwordValue"
            [passwordPolicy]="passwordPolicy">
          </app-password-strength>
        </div>

        <!-- Password Confirmation Field -->
        <div class="field">
          <label for="passwordConfirmation" class="block text-sm font-medium text-gray-700 mb-2">Confirm Password</label>
          <div class="relative">
            <input 
              id="passwordConfirmation"
              pInputText
              [type]="showPasswordConfirmation ? 'text' : 'password'"
              formControlName="passwordConfirmation"
              placeholder="Confirm your password"
              autocomplete="new-password"
              class="w-full pr-10"
              [class.ng-invalid]="(passwordConfirmation?.invalid && passwordConfirmation?.touched) || (setPasswordForm.errors?.['passwordMismatch'] && passwordConfirmation?.touched)"
              [class.ng-dirty]="passwordConfirmation?.touched" />
            <button 
              type="button"
              (click)="togglePasswordConfirmationVisibility()"
              class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
              <i class="pi" [class.pi-eye]="!showPasswordConfirmation" [class.pi-eye-slash]="showPasswordConfirmation"></i>
            </button>
          </div>
          <small *ngIf="passwordConfirmation?.invalid && passwordConfirmation?.touched" class="text-red-600">
            Password confirmation is required
          </small>
          <small *ngIf="setPasswordForm.errors?.['passwordMismatch'] && passwordConfirmation?.touched" class="text-red-600">
            Passwords do not match
          </small>
        </div>

        <!-- Submit Button -->
        <div>
          <button
            type="submit"
            [disabled]="setPasswordForm.invalid || isLoading"
            class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-gray-400 disabled:cursor-not-allowed">
            Set Password
          </button>
        </div>
      </form>

      <!-- Help Text -->
      <div class="mt-6 text-center">
        <p class="text-sm text-gray-600">
          Having trouble? 
          <a [routerLink]="['/auth/resend-activation']" class="font-medium text-indigo-600 hover:text-indigo-500">
            Request a new activation link
          </a>
        </p>
      </div>
    </div>
  </div>
</div>

