<div class="profile-container">
  <div class="profile-card">
    <!-- Header -->
    <div class="profile-header">
      <h1 class="profile-title">{{ t.translate('profile.title') }}</h1>
      <app-language-switcher></app-language-switcher>
    </div>

    <!-- Quick Actions -->
    <div *ngIf="!isEditMode && !isLoading" class="quick-actions">
      <button class="action-card" routerLink="/access-request">
        <span class="action-icon">üìã</span>
        <span class="action-label">{{ t.translate('profile.accessRequest') }}</span>
      </button>
      <button class="action-card" routerLink="/messages">
        <span class="action-icon">üì¨</span>
        <span class="action-label">{{ t.translate('profile.viewMessages') }}</span>
      </button>
      <button class="action-card" routerLink="/messages/compose">
        <span class="action-icon">‚úâÔ∏è</span>
        <span class="action-label">{{ t.translate('profile.composeMessage') }}</span>
      </button>
      <button class="action-card" (click)="enableEditMode()">
        <span class="action-icon">‚úèÔ∏è</span>
        <span class="action-label">{{ t.translate('profile.editProfile') }}</span>
      </button>
      <button class="action-card action-logout" (click)="onLogout()">
        <span class="action-icon">üö™</span>
        <span class="action-label">{{ t.translate('profile.logout') }}</span>
      </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <div class="spinner"></div>
      <p>{{ t.translate('profile.loading') }}</p>
    </div>

    <!-- Success Message -->
    <div *ngIf="successMessage" class="alert alert-success">
      <span class="icon">‚úÖ</span>
      {{ successMessage }}
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="alert alert-error">
      <span class="icon">‚ö†Ô∏è</span>
      {{ errorMessage }}
    </div>

    <!-- Profile Content -->
    <div *ngIf="profile && !isLoading" class="profile-content">
      <!-- Pending Email Notice -->
      <div *ngIf="profile.pendingEmail" class="alert alert-info">
        <span class="icon">üìß</span>
        <strong>Email change pending:</strong> Awaiting confirmation at {{ profile.pendingEmail }}
      </div>

      <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="profile-form">
        <!-- Personal Information -->
        <section class="form-section">
          <h2 class="section-title">{{ t.translate('profile.personalInfo') }}</h2>

          <div class="form-row">
            <!-- First Name -->
            <div class="form-group">
              <label for="firstName" class="form-label">
                {{ t.translate('profile.firstName') }} <span class="required">*</span>
              </label>
              <input
                id="firstName"
                type="text"
                formControlName="firstName"
                class="form-input"
                [class.error]="isFieldInvalid('firstName')"
                placeholder="Enter your first name"
              />
              <span *ngIf="isFieldInvalid('firstName')" class="error-message">
                {{ getFieldError('firstName') }}
              </span>
            </div>

            <!-- Last Name -->
            <div class="form-group">
              <label for="lastName" class="form-label">
                {{ t.translate('profile.lastName') }} <span class="required">*</span>
              </label>
              <input
                id="lastName"
                type="text"
                formControlName="lastName"
                class="form-input"
                [class.error]="isFieldInvalid('lastName')"
                placeholder="Enter your last name"
              />
              <span *ngIf="isFieldInvalid('lastName')" class="error-message">
                {{ getFieldError('lastName') }}
              </span>
            </div>
          </div>

          <div class="form-row">
            <!-- Phone Number -->
            <div class="form-group">
              <label for="phoneNumber" class="form-label">
                {{ t.translate('profile.phoneNumber') }} <span class="required">*</span>
              </label>
              <input
                id="phoneNumber"
                type="tel"
                formControlName="phoneNumber"
                class="form-input"
                [class.error]="isFieldInvalid('phoneNumber')"
                placeholder="+48123456789"
              />
              <span *ngIf="isFieldInvalid('phoneNumber')" class="error-message">
                {{ getFieldError('phoneNumber') }}
              </span>
              <span class="help-text">International format with country code</span>
            </div>

            <!-- Email -->
            <div class="form-group">
              <label for="email" class="form-label">
                {{ t.translate('profile.email') }} <span class="required">*</span>
              </label>
              <input
                id="email"
                type="email"
                formControlName="email"
                class="form-input"
                [class.error]="isFieldInvalid('email')"
                placeholder="your.email@example.com"
              />
              <span *ngIf="isFieldInvalid('email')" class="error-message">
                {{ getFieldError('email') }}
              </span>
              <span
                *ngIf="isEditMode && profileForm.get('email')?.value !== profile.email"
                class="help-text info"
              >
                ‚ÑπÔ∏è Email changes require confirmation via the new email address
              </span>
            </div>
          </div>
        </section>

        <!-- Account Information (Read-only) -->
        <section class="form-section">
          <h2 class="section-title">{{ t.translate('profile.accountInfo') }}</h2>

          <div class="form-row">
            <!-- PESEL (Masked) -->
            <div class="form-group">
              <label class="form-label">{{ t.translate('profile.pesel') }}</label>
              <div class="readonly-field">
                <span class="masked-value">***********{{ profile.peselLast4 }}</span>
                <span class="badge">{{ t.translate('profile.protected') }}</span>
              </div>
              <span class="help-text">{{ t.translate('profile.peselCannotChange') }}</span>
            </div>

            <!-- User Type -->
            <div class="form-group">
              <label class="form-label">{{ t.translate('profile.accountType') }}</label>
              <div class="readonly-field">
                <span class="badge badge-info">{{ profile.userType }}</span>
              </div>
            </div>
          </div>

          <div class="form-row">
            <!-- Created Date -->
            <div class="form-group">
              <label class="form-label">{{ t.translate('profile.accountCreated') }}</label>
              <div class="readonly-field">
                {{ formatDate(profile.createdDate) }}
              </div>
            </div>

            <!-- Last Login -->
            <div class="form-group">
              <label class="form-label">{{ t.translate('profile.lastLogin') }}</label>
              <div class="readonly-field">
                {{ formatDate(profile.lastLoginDate) }}
              </div>
            </div>
          </div>
        </section>

        <!-- Action Buttons -->
        <div class="form-actions" *ngIf="isEditMode">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="cancelEdit()"
            [disabled]="isLoading"
          >
            {{ t.translate('profile.cancel') }}
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="profileForm.invalid || isLoading"
          >
            <span *ngIf="!isLoading">{{ t.translate('profile.save') }}</span>
            <span *ngIf="isLoading">
              <span class="spinner-small"></span> {{ t.translate('profile.saving') }}
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
