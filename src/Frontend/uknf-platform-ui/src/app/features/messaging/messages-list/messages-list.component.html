<div class="messages-list-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">{{ t.translate('messages.title') }}</h1>
      <div class="header-actions">
        <app-language-switcher></app-language-switcher>
        <button routerLink="/profile" class="btn btn-secondary">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="icon"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
            />
          </svg>
          {{ t.translate('nav.profile') }}
        </button>
        <button routerLink="/messages/compose" class="btn btn-primary">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="icon"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 4v16m8-8H4"
            />
          </svg>
          {{ t.translate('messages.newMessage') }}
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>{{ t.translate('messages.loading') }}</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-message">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="error-icon"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
      />
    </svg>
    <p>{{ error }}</p>
    <button (click)="loadMessages()" class="btn btn-secondary">
      {{ t.translate('messages.retry') }}
    </button>
  </div>

  <!-- Messages List -->
  <div *ngIf="!isLoading && !error" class="messages-content">
    <!-- Empty State -->
    <div *ngIf="messages.length === 0" class="empty-state">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="empty-icon"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
        />
      </svg>
      <h2>{{ t.translate('messages.noMessages') }}</h2>
      <p>{{ t.translate('messages.noMessagesDesc') }}</p>
      <button routerLink="/messages/compose" class="btn btn-primary">
        {{ t.translate('messages.composeMessage') }}
      </button>
    </div>

    <!-- Messages Table -->
    <div *ngIf="messages.length > 0" class="messages-table-container">
      <table class="messages-table">
        <thead>
          <tr>
            <th class="col-status"></th>
            <th class="col-from">{{ t.translate('messages.from') }}</th>
            <th class="col-subject">{{ t.translate('messages.subject') }}</th>
            <th class="col-context">{{ t.translate('messages.context') }}</th>
            <th class="col-attachments">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="icon-sm"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"
                />
              </svg>
            </th>
            <th class="col-date">{{ t.translate('messages.date') }}</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let message of messages"
            [routerLink]="['/messages', message.messageId]"
            class="message-row"
            [class.message-unread]="!message.isRead"
          >
            <td class="col-status">
              <div class="status-indicator" [class.unread]="!message.isRead"></div>
            </td>
            <td class="col-from">
              <div class="sender-info">
                <div class="sender-name" [class.font-bold]="!message.isRead">
                  {{ message.senderName }}
                </div>
                <div class="sender-email">{{ message.senderEmail }}</div>
              </div>
            </td>
            <td class="col-subject">
              <div class="subject-info">
                <div class="subject" [class.font-bold]="!message.isRead">{{ message.subject }}</div>
                <div class="body-preview">{{ message.bodyPreview }}</div>
              </div>
            </td>
            <td class="col-context">
              <span class="context-badge" *ngIf="message.contextType !== 'Standalone'">
                {{ message.contextType }}
              </span>
            </td>
            <td class="col-attachments">
              <span class="attachment-count" *ngIf="message.attachmentCount > 0">
                {{ message.attachmentCount }}
              </span>
            </td>
            <td class="col-date">
              <div class="date-info">{{ formatDate(message.sentDate) }}</div>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination -->
      <div class="pagination" *ngIf="totalPages > 1">
        <button
          (click)="goToPage(currentPage - 1)"
          [disabled]="currentPage === 1"
          class="btn btn-secondary btn-sm"
        >
          {{ t.translate('messages.previous') }}
        </button>

        <div class="pagination-info">
          {{ t.translate('messages.page') }} {{ currentPage }} {{ t.translate('messages.of') }}
          {{ totalPages }} ({{ totalCount }} {{ t.translate('messages.count') }})
        </div>

        <button
          (click)="goToPage(currentPage + 1)"
          [disabled]="currentPage === totalPages"
          class="btn btn-secondary btn-sm"
        >
          {{ t.translate('messages.next') }}
        </button>
      </div>
    </div>
  </div>
</div>
